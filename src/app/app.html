<h2>Excel Mobile Cleaner</h2>

<!-- STEP 1 -->
<div class="step-card">
  <h3>Step 1: Upload Excel File</h3>
  <p>Select an Excel file (.xls or .xlsx) by dragging it here or clicking.</p>

  <div
    class="drop-zone"
    [class.dragging]="isDragging"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()"
  >
    <p *ngIf="!fileName">
      Drag & drop Excel file here<br />
      <small>or click to upload</small>
    </p>

    <p *ngIf="fileName">
      Selected file:
      <strong>{{ fileName }}.xlsx</strong>
    </p>

    <input
      #fileInput
      type="file"
      accept=".xls,.xlsx"
      hidden
      (change)="onFileChange($event)"
    />
  </div>
</div>

<!-- STEP 2 -->
<div class="step-card" *ngIf="fileName">
  <h3>Step 2: Select Sheet & Preview</h3>
  <p>Choose the sheet you want to clean, then click Preview.</p>

  <label>Sheet:</label>
  <select [(ngModel)]="selectedSheet">
    <option *ngFor="let s of sheetNames" [value]="s">
      {{ s }}
    </option>
  </select>

  <button (click)="previewSheet()">Preview</button>
</div>

<!-- PROCESSING FEEDBACK -->
<div class="step-card" *ngIf="isProcessing">
  <p><strong>Cleaning dataâ€¦</strong> {{ progress }}%</p>
</div>

<div class="step-card" *ngIf="!isProcessing && progress === 100">
  <p>âœ… Cleaning complete. Your file has been downloaded.</p>
</div>

<!-- STEP 3 -->
<div class="step-card" *ngIf="showPreview && previewData.length">
  <h3>Step 3: Select Header Row</h3>
  <p>Click <strong>Header</strong> on the row that contains column names.</p>

  <div class="preview-table">
    <table>
      <tr
        *ngFor="let row of previewData; let i = index"
        [class.header-selected]="headerRowIndex === i"
      >
        <td>
          <button
            (click)="setHeaderRow(i)"
            [style.background]="headerRowIndex === i ? '#4caf50' : ''"
            [style.color]="headerRowIndex === i ? 'white' : ''"
          >
            Header
          </button>
        </td>
        <td *ngFor="let cell of row">
          {{ cell }}
        </td>
      </tr>
    </table>
  </div>
</div>

<!-- STEP 4 -->
<div class="step-card" *ngIf="headers.length">
  <h3>Step 4: Select Mobile Columns</h3>
  <p>Select one or more columns that contain mobile numbers.</p>

  <div class="mobile-columns">
    <label *ngFor="let h of headers; let i = index">
      <input
        type="checkbox"
        [checked]="selectedColumns.includes(i)"
        (change)="toggleColumn(i)"
      />
      <strong *ngIf="selectedColumns.includes(i)">ðŸ“±</strong>
      {{ h }}
    </label>
  </div>
</div>

<!-- STEP 5 -->
<div class="step-card" *ngIf="headers.length">
  <h3>Step 5: Clean & Download</h3>
  <p>
    Invalid rows will be removed. Empty mobile cells may be auto-filled using
    valid numbers from the same row.
  </p>

  <button
    class="primary-btn"
    (click)="cleanAndDownload()"
    [disabled]="isProcessing"
  >
    Clean Mobile Numbers & Download
  </button>
</div>
